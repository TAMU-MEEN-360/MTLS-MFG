<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Engineering Stress–Strain (ASTM A36 Steel)</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f3f4f6;
      color: #111827;
    }
    h1 {
      text-align: center;
      margin-bottom: 5px;
    }
    p {
      text-align: center;
      color: #374151;
    }
    #curve {
      max-width: 1000px;
      height: 600px;
      margin: auto;
    }
    a {
      display: block;
      text-align: center;
      margin-top: 15px;
      color: #4f46e5;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    /* Modal styling */
    .modal-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    .modal {
      background: white;
      width: 700px;
      max-width: 95%;
      border-radius: 12px;
      overflow: hidden;
    }
    .modal-header {
      background: #111827;
      color: white;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-header h2 {
      font-size: 16px;
      margin: 0;
    }
    .close-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 6px 10px;
      cursor: pointer;
      border-radius: 6px;
    }
    .modal-body {
      padding: 16px;
      line-height: 1.45;
    }
    .kv {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
      font-size: 14px;
    }
    .pill {
      background: #e5e7eb;
      border-radius: 999px;
      padding: 3px 10px;
      font-size: 12px;
      margin-right: 6px;
    }
  </style>
</head>

<body>

<h1>Engineering Stress–Strain (ASTM A36 Steel)</h1>
<p>Click key points or shaded regions to learn what each part represents.</p>

<div id="curve"></div>
<a href="index.html">← Back to Home</a>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div class="modal-header">
      <h2 id="modalTitle"></h2>
      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
    <div class="modal-body">
      <div id="modalContent"></div>
      <div class="kv" id="modalKV"></div>
    </div>
  </div>
</div>

<script>
  // -----------------------------
  // ASTM A36 material properties
  // -----------------------------
  const E = 200000;        // MPa
  const sigma_y = 250;     // MPa
  const sigma_uts = 430;   // MPa

  // Derived values
  const eps_y = sigma_y / E; // elastic strain at yield
  const eps_prop = 0.0011;
  const sigma_prop = E * eps_prop;

  // -----------------------------
  // Stress–strain curve (engineering)
  // -----------------------------
  const curve = [
    {x: 0.0,    y: 0},
    {x: 0.0006, y: E * 0.0006},
    {x: eps_prop, y: sigma_prop},
    {x: eps_y,  y: sigma_y},
    {x: 0.01,   y: sigma_y + 5},
    {x: 0.03,   y: 310},
    {x: 0.07,   y: 380},
    {x: 0.12,   y: sigma_uts},   // UTS (necking starts)
    {x: 0.18,   y: 410},
    {x: 0.25,   y: 340}           // fracture
  ];

  // -----------------------------
  // 0.2% offset line (SHORTENED)
  // -----------------------------
  const offsetX = [];
  const offsetY = [];
  for (let eps = 0.002; eps <= 0.006; eps += 0.0001) {
    offsetX.push(eps);
    offsetY.push(E * (eps - 0.002));
  }

  // -----------------------------
  // Modulus of resilience (shaded)
  // -----------------------------
  const Ur = (sigma_y * sigma_y) / (2 * E);

  const resilienceTrace = {
    x: [0, eps_y, 0],
    y: [0, sigma_y, 0],
    fill: 'toself',
    opacity: 0.35,
    name: 'Modulus of Resilience',
    hoverinfo: 'skip'
  };

  // -----------------------------
  // Clickable markers
  // -----------------------------
  const markers = [
    {
      name: "Elastic Modulus (E)",
      x: 0.0007,
      y: E * 0.0007,
      title: "Modulus of Elasticity (E)",
      text: "Slope of elastic region: σ = Eε",
      kv: { "E": "200 GPa", "Meaning": "Material stiffness" }
    },
    {
      name: "Proportional Limit",
      x: eps_prop,
      y: sigma_prop,
      title: "Proportional Limit",
      text: "End of perfectly linear stress–strain behavior.",
      kv: { "σ": "≈220 MPa", "ε": eps_prop.toFixed(4) }
    },
    {
      name: "Yield Strength",
      x: eps_y,
      y: sigma_y,
      title: "Yield Strength (σy)",
      text: "Permanent plastic deformation begins.",
      kv: { "σy": "250 MPa", "Definition": "A36 minimum yield" }
    },
    {
      name: "UTS / Necking starts",
      x: 0.12,
      y: sigma_uts,
      title: "Ultimate Tensile Strength (UTS)",
      text: "Maximum engineering stress. Necking begins here.",
      kv: { "UTS": "430 MPa", "After this": "Localized deformation" }
    },
    {
      name: "Fracture",
      x: 0.25,
      y: 340,
      title: "Fracture",
      text: "Final failure of specimen after necking.",
      kv: { "Occurs after": "Necking", "Type": "Ductile fracture" }
    }
  ];

  // -----------------------------
  // Plotly traces
  // -----------------------------
  const curveTrace = {
    x: curve.map(p => p.x),
    y: curve.map(p => p.y),
    mode: 'lines',
    line: { width: 4 },
    name: 'A36 Steel'
  };

  const offsetTrace = {
    x: offsetX,
    y: offsetY,
    mode: 'lines',
    line: { dash: 'dash', width: 2 },
    name: '0.2% Offset Line'
  };

  const markerTrace = {
    x: markers.map(p => p.x),
    y: markers.map(p => p.y),
    mode: 'markers+text',
    text: markers.map(p => p.name),
    textposition: 'top center',
    marker: { size: 10 },
    customdata: markers
  };

  const layout = {
    xaxis: { title: 'Strain, ε (in/in)' },
    yaxis: {
      title: 'Stress, σ (MPa)',
      range: [0, 500]
    },
    legend: { orientation: 'h', y: -0.2 }
  };

  Plotly.newPlot(
    'curve',
    [resilienceTrace, curveTrace, offsetTrace, markerTrace],
    layout,
    { responsive: true }
  );

  // -----------------------------
  // Modal logic
  // -----------------------------
  function openModal(data) {
    document.getElementById('modalTitle').innerText = data.title;
    document.getElementById('modalContent').innerText = data.text;
    const kv = document.getElementById('modalKV');
    kv.innerHTML = '';
    Object.entries(data.kv).forEach(([k,v]) => {
      kv.innerHTML += `<div><span class="pill">${k}</span><b>${v}</b></div>`;
    });
    document.getElementById('modalBackdrop').style.display = 'flex';
  }

  function closeModal() {
    document.getElementById('modalBackdrop').style.display = 'none';
  }

  document.getElementById('curve').on('plotly_click', function(e) {
    if (e.points[0].customdata) {
      openModal(e.points[0].customdata);
    }
  });
</script>

</body>
</html>
