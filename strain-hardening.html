<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stress–Strain Curve</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div id="stressStrainPlot" style="width:100%;max-width:900px;height:600px;margin:auto;"></div>

<script>
  /* -----------------------------
     Define material-style values
  ------------------------------*/
  const E = 200;              // Young's modulus (arbitrary units)
  const proportionalLimitStrain = 0.0018;
  const yieldOffset = 0.002;

  /* -----------------------------
     Build stress-strain curve
  ------------------------------*/
  let strain = [];
  let stress = [];

  for (let i = 0; i <= 300; i++) {
    let eps = i * 0.00002;

    let sig;
    if (eps <= proportionalLimitStrain) {
      // Linear elastic region
      sig = E * eps;
    } else {
      // Nonlinear plastic region with decreasing slope
      sig = E * proportionalLimitStrain
          + 35 * (eps - proportionalLimitStrain)
          - 300 * Math.pow(eps - proportionalLimitStrain, 2);
    }

    strain.push(eps);
    stress.push(sig);
  }

  /* -----------------------------
     0.2% offset line
  ------------------------------*/
  let offsetStrain = [];
  let offsetStress = [];

  for (let i = 0; i <= 300; i++) {
    let eps = i * 0.00002;
    offsetStrain.push(eps);
    offsetStress.push(E * (eps - yieldOffset));
  }

  /* -----------------------------
     Find yield point (intersection)
  ------------------------------*/
  let yieldIndex = 0;
  let minDiff = Infinity;

  for (let i = 0; i < strain.length; i++) {
    let diff = Math.abs(stress[i] - offsetStress[i]);
    if (diff < minDiff) {
      minDiff = diff;
      yieldIndex = i;
    }
  }

  const yieldStrain = strain[yieldIndex];
  const yieldStress = stress[yieldIndex];

  const proportionalStress = E * proportionalLimitStrain;

  /* -----------------------------
     Special points
  ------------------------------*/
  const utsIndex = stress.indexOf(Math.max(...stress));
  const fractureIndex = strain.length - 1;

  const points = {
    strain: [
      proportionalLimitStrain,
      yieldStrain,
      strain[utsIndex],
      strain[fractureIndex]
    ],
    stress: [
      proportionalStress,
      yieldStress,
      stress[utsIndex],
      stress[fractureIndex]
    ],
    labels: [
      "Proportional Limit",
      "Yield Strength (0.2% offset)",
      "Ultimate Tensile Strength",
      "Fracture"
    ]
  };

  /* -----------------------------
     Plot traces
  ------------------------------*/
  const curveTrace = {
    x: strain,
    y: stress,
    mode: "lines",
    name: "Stress–Strain Curve",
    line: { width: 3 }
  };

  const offsetTrace = {
    x: offsetStrain,
    y: offsetStress,
    mode: "lines",
    name: "0.2% Offset Line",
    line: { dash: "dot", width: 2 }
  };

  const pointsTrace = {
    x: points.strain,
    y: points.stress,
    mode: "markers",
    marker: { size: 10 },
    text: points.labels.map((label, i) =>
      `${label}<br>Strain = ${points.strain[i].toFixed(4)}<br>Stress = ${points.stress[i].toFixed(1)}`
    ),
    hoverinfo: "text",
    name: "Key Points"
  };

  /* -----------------------------
     Layout
  ------------------------------*/
  const layout = {
    title: "Stress–Strain Curve with 0.2% Offset Method",
    xaxis: {
      title: "Strain",
      zeroline: false
    },
    yaxis: {
      title: "Stress",
      zeroline: false
    },
    hovermode: "closest"
  };

  Plotly.newPlot(
    "stressStrainPlot",
    [curveTrace, offsetTrace, pointsTrace],
    layout
  );
</script>

</body>
</html>
