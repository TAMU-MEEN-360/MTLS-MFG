<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Engineering Stress–Strain Curve</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div id="plot" style="width:100%;max-width:950px;height:600px;margin:auto;"></div>

<script>
/* -----------------------------
   Parameters (engineering-style)
------------------------------*/
const E = 15000;                 // Young’s modulus (psi, scaled)
const propLimitStrain = 0.0035;
const offsetStrain = 0.002;

/* -----------------------------
   Main stress–strain curve
------------------------------*/
let strain = [];
let stress = [];

for (let i = 0; i <= 400; i++) {
  let e = i * 0.00025;

  let s;
  if (e <= propLimitStrain) {
    // Linear elastic region
    s = E * e;
  } else if (e <= 0.06) {
    // Plastic deformation, decreasing slope
    s = E * propLimitStrain
        + 25000 * (e - propLimitStrain)
        - 180000 * Math.pow(e - propLimitStrain, 2);
  } else {
    // Necking to fracture
    s = 40000 - 15000 * (e - 0.06);
  }

  strain.push(e);
  stress.push(Math.max(s, 0));
}

/* -----------------------------
   0.2% offset line
------------------------------*/
let offsetX = [];
let offsetY = [];

for (let i = 0; i <= 400; i++) {
  let e = i * 0.00025;
  offsetX.push(e);
  offsetY.push(E * (e - offsetStrain));
}

/* -----------------------------
   Yield point (intersection)
------------------------------*/
let yieldIndex = 0;
let minDiff = Infinity;

for (let i = 0; i < strain.length; i++) {
  let diff = Math.abs(stress[i] - offsetY[i]);
  if (diff < minDiff) {
    minDiff = diff;
    yieldIndex = i;
  }
}

const yieldStrain = strain[yieldIndex];
const yieldStress = stress[yieldIndex];
const propStress = E * propLimitStrain;

/* -----------------------------
   Ultimate & fracture
------------------------------*/
const utsIndex = stress.indexOf(Math.max(...stress));
const fractureIndex = strain.length - 1;

/* -----------------------------
   Plot traces
------------------------------*/
const curve = {
  x: strain,
  y: stress,
  mode: "lines",
  line: { width: 3, color: "red" },
  name: "Stress–Strain Curve"
};

const offsetLine = {
  x: offsetX,
  y: offsetY,
  mode: "lines",
  line: { dash: "dash", width: 2, color: "black" },
  name: "0.2% Offset Line"
};

const points = {
  x: [
    propLimitStrain,
    yieldStrain,
    strain[utsIndex],
    strain[fractureIndex]
  ],
  y: [
    propStress,
    yieldStress,
    stress[utsIndex],
    stress[fractureIndex]
  ],
  mode: "markers",
  marker: { size: 9, color: "black" },
  text: [
    "Proportional Limit<br>(end of linear elastic region)",
    `Yield Strength (0.2% offset)<br>σᵧ ≈ ${yieldStress.toFixed(0)} psi`,
    "Ultimate Tensile Strength",
    "Fracture"
  ],
  hoverinfo: "text",
  name: "Key Points"
};

/* -----------------------------
   Annotations (textbook style)
------------------------------*/
const annotations = [
  {
    x: 0.0018,
    y: 20000,
    text: "Elastic stretching",
    showarrow: false
  },
  {
    x: 0.035,
    y: 37000,
    text: "Plastic deformation",
    showarrow: false
  },
  {
    x: yieldStrain,
    y: yieldStress + 3000,
    text: "Offset yield strength",
    arrowhead: 3
  },
  {
    x: 0.095,
    y: 10000,
    text: "Strain to failure",
    showarrow: false
  }
];

/* -----------------------------
   Layout (matches textbook look)
------------------------------*/
const layout = {
  title: "Engineering Stress–Strain Diagram",
  plot_bgcolor: "#dbe7f3",
  paper_bgcolor: "white",
  xaxis: {
    title: "Engineering strain e (in./in.)",
    range: [0, 0.14],
    dtick: 0.02,
    zeroline: false
  },
  yaxis: {
    title: "Engineering stress s (psi)",
    range: [0, 45000],
    dtick: 5000,
    zeroline: false
  },
  annotations: annotations,
  hovermode: "closest"
};

Plotly.newPlot("plot", [curve, offsetLine, points], layout);
</script>

</body>
</html>
