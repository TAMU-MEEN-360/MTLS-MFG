<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Engineering Stress–Strain Curve (Mild Carbon Steel)</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
<div id="plot" style="width:100%;height:850px;"></div>

<script>
// -------------------- Material Properties --------------------
const E = 200000;            // MPa (Elastic Modulus)
const yieldStress = 225;     // MPa
const yieldStrain = yieldStress / E;
const fractureStrain = 0.25;
const ultimateStress = 400;

// -------------------- Stress–Strain Curve --------------------
function stressStrain(e) {
  if (e <= yieldStrain * 0.95) return E * e;
  if (e <= yieldStrain) return yieldStress * (0.95 + 0.05 * (e / yieldStrain));
  if (e <= 0.15) return yieldStress + (ultimateStress - yieldStress) * ((e - yieldStrain) / (0.15 - yieldStrain));
  return ultimateStress * (1 - (e - 0.15) / (fractureStrain - 0.15));
}

const strain = [], stress = [];
for (let e = 0; e <= fractureStrain; e += 0.0005) {
  strain.push(e);
  stress.push(stressStrain(e));
}

// -------------------- Offset Line (Stops at Yield) --------------------
const offsetX = [], offsetY = [];
for (let e = 0.002; e <= 0.01; e += 0.0001) {
  const s = E * (e - 0.002);
  if (s >= yieldStress) break;
  offsetX.push(e);
  offsetY.push(s);
}

// -------------------- Toughness Shading --------------------
const toughnessArea = {
  x: [...strain, fractureStrain, 0],
  y: [...stress, 0, 0],
  fill: "toself",
  fillcolor: "rgba(255,165,0,0.25)",
  line: { width: 0 },
  name: "Tensile Toughness",
  hoverinfo: "skip"
};

// -------------------- Modulus of Resilience Shading --------------------
const resilienceStrain = [], resilienceStress = [];
for (let e = 0; e <= yieldStrain; e += 0.0005) {
  resilienceStrain.push(e);
  resilienceStress.push(stressStrain(e));
}

const resilienceArea = {
  x: [...resilienceStrain, yieldStrain, 0],
  y: [...resilienceStress, 0, 0],
  fill: "toself",
  fillcolor: "rgba(0,150,255,0.25)",
  line: { width: 0 },
  name: "Modulus of Resilience",
  hoverinfo: "skip"
};

// -------------------- Main Curve --------------------
const mainCurve = {
  x: strain,
  y: stress,
  mode: "lines",
  name: "Stress–Strain Curve",
  line: { color: "black", width: 3 }
};

// -------------------- Offset Line --------------------
const offsetLine = {
  x: offsetX,
  y: offsetY,
  mode: "lines",
  name: "0.2% Offset Line",
  line: { color: "green", dash: "dash" }
};

// -------------------- Ductility Line --------------------
const ductilityLine = {
  x: [fractureStrain, fractureStrain],
  y: [0, ultimateStress],
  mode: "lines",
  name: "Ductility",
  line: { color: "purple", dash: "dot" }
};

// -------------------- Annotation Points --------------------
const points = {
  x: [
    yieldStrain,                        // Yield
    fractureStrain,                     // Ductility (x-axis)
    0.125,                              // Toughness label
    yieldStrain / 2,                    // Resilience label
    0.007,                              // Elastic Modulus on offset line (moved up)
    fractureStrain,                     // Elastic Modulus on ductility
    0.003                               // Elastic Modulus on proportional region
  ],
  y: [
    yieldStress,
    0,
    150,
    110,
    E * (0.007 - 0.002),
    ultimateStress / 2,
    E * 0.003
  ],
  text: [
    "Yield Strength<br>Start of Plastic Deformation",
    "Ductility<br>Fracture Strain",
    "Tensile Toughness<br>Energy to Fracture",
    "Modulus of Resilience<br>Elastic Energy Storage",
    "Slope = Elastic Modulus",
    "Slope = Elastic Modulus",
    "Slope = Elastic Modulus"
  ],
  mode: "markers",
  marker: {
    size: 10,
    color: [
      "red",
      "purple",
      "orange",
      "rgb(0,150,255)",
      "green",
      "purple",
      "black"
    ]
  },
  hoverinfo: "text",
  name: "Key Points"
};

// -------------------- Layout --------------------
const layout = {
  title: "Engineering Stress–Strain Curve (Mild Carbon Steel)",
  grid: { rows: 2, columns: 1, pattern: "independent" },

  xaxis: { title: "Strain" },
  yaxis: { title: "Stress (MPa)" },

  xaxis2: { title: "Strain (Zoomed Elastic Region)", range: [0, 0.01] },
  yaxis2: { title: "Stress (MPa)", range: [0, 300] },

  annotations: [
    {
      text: "<b>Zoomed-In Elastic Region</b>",
      xref: "paper",
      yref: "paper",
      x: 0.5,
      y: 0.47,
      showarrow: false,
      font: { size: 14 }
    }
  ]
};

// -------------------- Render --------------------
Plotly.newPlot("plot", [
  toughnessArea,
  resilienceArea,
  mainCurve,
  offsetLine,
  ductilityLine,
  points
], layout);
</script>
</body>
</html>
